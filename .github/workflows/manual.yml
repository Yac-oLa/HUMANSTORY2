name: Build and Deploy

on:
  push:
    branches:
      - main  # 원하는 브랜치로 변경

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3  # Node.js 20을 지원하는 최신 버전

    - name: Set up JDK 11
      uses: actions/setup-java@v3  # Node.js 20을 지원하는 최신 버전
      with:
        distribution: 'adopt'  # 사용할 JDK 배포판 (AdoptOpenJDK)
        java-version: '11'

    - name: Build with Maven
      run: mvn clean package  # Maven을 사용하여 프로젝트 빌드, WAR 파일 생성

    - name: Build and Push Docker image
      uses: docker/build-push-action@v2
      with:
        context: .  # Docker 컨텍스트는 현재 디렉토리
        file: ./Dockerfile  # 사용할 Dockerfile 경로 지정
        push: true
        tags: |
          kangejaeheon/human:latest  # Docker Hub 레지스트리에 업로드할 이미지 태그
      env:
        username: ${{ secrets.DOCKERHUB_ID }}  # Docker Hub 사용자 이름은 비밀로 관리되는 저장소 시크릿에서 가져옴
        password: ${{ secrets.DOCKERHUB_TOKEN }}  # Docker Hub 암호는 비밀로 관리되는 저장소 시크릿에서 가져옴
